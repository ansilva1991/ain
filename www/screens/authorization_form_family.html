<div class="authorization-form-family">
  <form class="form-horizontal">
    <div class="input-avatar">
      <img src="img/avatar.png" id="avatar">
      <div class="buttons">
        <button type="button" onclick="cs.avatarFrom('gallery');">
          <i class="fa fa-image"></i>
        </button>
        <button type="button" onclick="cs.avatarFrom('camera');">
          <i class="fa fa-camera"></i>
        </button>
      </div>
    </div>
    <div class="form-group">
      <label for="name">NOMBRE</label>
      <input type="text" name="name" id="name" class="form-control">
    </div>
    <div class="form-group">
      <label for="last_name">APELLIDO</label>
      <input type="text" name="last_name" id="last_name" class="form-control">
    </div>
    <div class="form-group">
      <label for="real_id">DNI</label>
      <input type="number" name="real_id" id="real_id" class="form-control">
    </div>
    <div class="form-group">
      <label for="sex">SEXO</label>
      <div class="form-radios">
        <div class="row" id="sex">
          <div class="radio">
            <div class="circle"></div>
            <span>Masculino</span>
          </div>
          <div class="radio">
            <div class="circle"></div>
            <span>Femenino</span>
          </div>
          <div class="radio">
            <div class="circle"></div>
            <span>Otro</span>
          </div>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="birthdate">FECHA DE NACIMIENTO</label>
      <input type="date" name="birthdate" id="birthdate" class="form-control">
    </div>
    <div class="form-group">
      <label for="phone">Teléfono de contacto</label>
      <input type="tel" name="phone" id="phone" class="form-control">
    </div>
    <div class="form-group-checkbox">
      <label for="name">¿Dar acceso al sistema?</label>
      <div class="checkbox for_tap">
        <input type="checkbox" id="have_access">
        <div class="box">
          <div class="pointer"></div>
        </div>
      </div>
    </div>
    <div class="form-dropdown">
      <div class="form-group">
        <label for="email">EMAIL</label>
        <input type="text" name="email" id="email" class="form-control">
      </div>
      <center>
        <h5>
          Se le enviará una notificación al email ingresado con las instrucciones de uso.
        </h5>
        <h5>
          Al permitirle acceso al sistema, podra gestionar visitas y empleados, crear eventos, enviar y responder comunicaciones, entre otras funciones.
        </h5>
      </center>
    </div>
  </form>
</div>

<script type="text/javascript">
  function c(){
    this.last_screen_height = 0;
    this.person_id;
    this.callback_get_person_info;
    this.started = false;

    this.start = function(opts){
      opts = opts || {};

      this.person_id = opts.person_id;

      $(window).resize(function(){
        Extends.scrollToInputFocus('.authorization-form-family');
      });

      Extends.inputCheckBox();
      Extends.inputRadios('.form-radios');

      $('#have_access').change(function(){

        if($(this).is(':checked')){
          $('.form-dropdown').addClass('open');

          if(cs.started){
            setTimeout(function(){
              $('.authorization-form-family').scrollToBottom(250);
            },200);
          }
        }else{
          $('.form-dropdown').removeClass('open');
        }
      });

      app.liActive('authorizations');
      this.getPersonInfo(function(){
        app.pageLoading('hide');
        cs.started = true;
      });
    }

    this.getPersonInfo = function(callback){
      this.callback_get_person_info = callback;

      Server.send({
        route : [PrivateData.get('current_server_portal'),'app','people','edit_family'],
        data : {
          person_id: this.person_id
        },
        callback : function(data, success){
          console.log(data);
          if(success){
            $('#name').val(data.person.name);
            $('#last_name').val(data.person.last_name);
            $('#real_id').val(data.person.real_id);
            $($('#sex .radio')[data.person.sex]).addClass('checked');
            $('#birthdate').val(data.person.birthdate);
            $('#phone').val(data.person.phone);
            $('#email').val(data.person.email);

            if(data.person.avatar){
              $('#avatar').attr('src',data.person.avatar);
            }

            if(data.person.type == 'AuthorizationOwnerGroup' || data.person.type == 'AuthorizationFamilyWithAccess'){

              $('#have_access').prop('checked', true);
              $('#have_access').change();
            }

            cs.callback_get_person_info();
          }
        }
      });
    }

    this.submit = function(){
      app.loadScreen(app.SCREENS.AUTHORIZATIONS);
    };

    this.back = function(){
      app.loadScreen(app.SCREENS.AUTHORIZATIONS);
    };

    this.avatarFrom = function(type){
      app.takeFromCamera(function(imageData){
        $('img#avatar').attr('src',"data:image/jpeg;base64," + imageData);
      },function(errorMessage){
      },{
        quality: 50,
        sourceType: (type == 'camera') ? Camera.PictureSourceType.CAMERA : Camera.PictureSourceType.PHOTOLIBRARY,
        destinationType: Camera.DestinationType.DATA_URL,
        allowEdit : true,
        targetWidth: 128,
        targetHeight: 128
      });
    };

    this.giveAccess = function(){
      $('.system-access-granted').show();
      $('.system-access-denied').hide();
    };

    this.removeAccess = function(){
      $('.system-access-granted').hide();
      $('.system-access-denied').show();
    };

  }
</script>